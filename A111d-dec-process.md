# Gini Impurity בעצי החלטה

## מהו Gini Impurity?

Gini Impurity (אי-טוהר ג'יני) הוא מדד המשמש באלגוריתמים של עצי החלטה כדי לקבוע כיצד לפצל את הנתונים בצורה אופטימלית. המדד מודד את ההסתברות שפריט שנבחר באקראי מקבוצה יתויג בצורה שגויה אם התיוג נעשה לפי התפלגות התוויות באותה קבוצה.

במילים פשוטות, Gini Impurity מודד כמה "טהור" או "הומוגני" הוא צומת בעץ - האם הוא מכיל בעיקר דגימות מקטגוריה אחת או תערובת של כמה קטגוריות.

## למה צריך את Gini Impurity?

בעצי החלטה, אנחנו צריכים קריטריון לקבוע:
1. **באיזה משתנה (feature) להשתמש** לפיצול הנתונים
2. **באיזה ערך סף (threshold)** לבצע את הפיצול

Gini Impurity עוזר לנו לענות על שאלות אלו מהסיבות הבאות:

1. **קריטריון לפיצול אופטימלי**: הוא מאפשר לאלגוריתם להעריך איזה פיצול יוביל לקבוצות טהורות יותר של נתונים
2. **מדידת שיפור**: באמצעות השוואת ה-Gini Impurity לפני ואחרי פיצול אפשרי, האלגוריתם יכול לחשב את ה"רווח המידע" ולבחור את הפיצול שמייצר את הירידה הגדולה ביותר באי-טוהר
3. **מניעת התאמת יתר (overfitting)**: שימוש במדד זה מוביל לפיצולים בעלי משמעות במקום פיצולים שרירותיים
4. **יעילות חישובית**: חישוב Gini Impurity מהיר יחסית לעומת מדדים אחרים

## הנוסחה של Gini Impurity

הנוסחה המתמטית של Gini Impurity היא:

$$G(Q) = \sum_{c \in C} p_c(1-p_c)$$

כאשר:
- **Q** מסמל צומת מסוים בעץ ההחלטה
- **G(Q)** הוא ערך ה-Gini Impurity של אותו צומת Q
- **C** הוא קבוצת הקטגוריות (מחלקות) בצומת
- **$p_c$** הוא ההסתברות שאובייקט בצומת משתייך לקטגוריה c
- **$1-p_c$** הוא ההסתברות שאובייקט בצומת לא משתייך לקטגוריה c
- **$\sum$** מסמל סכימה על כל הקטגוריות בצומת Q

נוסחה שקולה נוספת שמשתמשים בה לעתים קרובות:

$$G(Q) = 1 - \sum_{c \in C} p_c^2$$

לסיווג בינארי (שתי קטגוריות בלבד), הנוסחה מתפשטת ל:

$$G(Q) = 1 - [(p_1)^2 + (p_2)^2]$$

## חישוב Gini Impurity - דוגמה

נניח שיש לנו קבוצת נתונים עם 10 דגימות:
- 7 דגימות שייכות לקטגוריה A
- 3 דגימות שייכות לקטגוריה B

נחשב את Gini Impurity של הצומת:

$$G(Q) = 1 - [(7/10)^2 + (3/10)^2]$$
$$G(Q) = 1 - [0.49 + 0.09]$$
$$G(Q) = 1 - 0.58$$
$$G(Q) = 0.42$$

ערך זה (0.42) מעיד על כך שהצומת אינו טהור לחלוטין. 
- כאשר G(Q) = 0, הצומת טהור לחלוטין (כל הדגימות שייכות לאותה קטגוריה)
- כאשר G(Q) = 0.5 (בסיווג בינארי), הצומת בעל אי-טוהר מקסימלי (חלוקה שווה בין הקטגוריות)

## חישוב Gini Impurity בעץ החלטה

נניח שיש לנו מערכת נתונים פשוטה עם שני מאפיינים (X1, X2) וקטגוריה יעד (Y) כפי שמוצג בטבלה:

| X1 | X2 | Y |
|----|----|----|
| 1  | 3  | A  |
| 2  | 1  | A  |
| 3  | 2  | B  |
| 4  | 3  | B  |
| 5  | 1  | A  |
| 6  | 2  | B  |

נחשב את Gini Impurity של הצומת השורש:
- 3 דגימות מקטגוריה A (p_A = 3/6 = 0.5)
- 3 דגימות מקטגוריה B (p_B = 3/6 = 0.5)

$$G(root) = 1 - [(0.5)^2 + (0.5)^2] = 1 - 0.5 = 0.5$$

עכשיו, נניח שאנחנו שוקלים לפצל את הנתונים לפי X1 ≤ 3:
- צומת שמאל (X1 ≤ 3): 2 דגימות מקטגוריה A (p_A = 2/3), 1 דגימה מקטגוריה B (p_B = 1/3)
  - G(שמאל) = 1 - [(2/3)^2 + (1/3)^2] = 1 - [0.44 + 0.11] = 0.44
- צומת ימין (X1 > 3): 1 דגימה מקטגוריה A (p_A = 1/3), 2 דגימות מקטגוריה B (p_B = 2/3)
  - G(ימין) = 1 - [(1/3)^2 + (2/3)^2] = 1 - [0.11 + 0.44] = 0.44

הממוצע המשוקלל של Gini Impurity אחרי הפיצול:
$$G_{weighted} = \frac{n_{left}}{n_{total}} \cdot G(left) + \frac{n_{right}}{n_{total}} \cdot G(right)$$
$$G_{weighted} = \frac{3}{6} \cdot 0.44 + \frac{3}{6} \cdot 0.44 = 0.44$$

הרווח מהפיצול (Gini Gain):
$$Gain = G(root) - G_{weighted} = 0.5 - 0.44 = 0.06$$

נבדוק עכשיו פיצול אחר לפי X2 ≤ 2:
- צומת שמאל (X2 ≤ 2): 1 דגימה מקטגוריה A, 2 דגימות מקטגוריה B
  - G(שמאל) = 1 - [(1/3)^2 + (2/3)^2] = 0.44
- צומת ימין (X2 > 2): 2 דגימות מקטגוריה A, 1 דגימה מקטגוריה B
  - G(ימין) = 1 - [(2/3)^2 + (1/3)^2] = 0.44

הממוצע המשוקלל:
$$G_{weighted} = \frac{3}{6} \cdot 0.44 + \frac{3}{6} \cdot 0.44 = 0.44$$

הרווח מהפיצול:
$$Gain = 0.5 - 0.44 = 0.06$$

בדוגמה זו, שני הפיצולים מספקים את אותו הרווח. במקרה כזה, האלגוריתם יכול לבחור באחד מהם באופן שרירותי או לפי קריטריונים אחרים (כמו פשטות המודל).

## כיצד Gini Impurity עוזר בבניית עץ החלטה

תהליך בניית עץ החלטה באמצעות Gini Impurity כולל את השלבים הבאים:

1. **חישוב Gini Impurity של הצומת הנוכחי**
2. **עבור כל מאפיין אפשרי**:
   - עבור כל נקודת פיצול אפשרית במאפיין:
     - פיצול הנתונים
     - חישוב Gini Impurity המשוקלל של צמתי הבנים הנוצרים
     - חישוב הרווח (Gini Gain)
3. **בחירת המאפיין ונקודת הפיצול** שמספקים את הרווח המקסימלי
4. **יצירת צמתי בנים** באמצעות הפיצול הזה
5. **חזרה על התהליך באופן רקורסיבי** על כל צומת בן עד שמתקיים קריטריון עצירה

היתרונות של שימוש ב-Gini Impurity:

1. **בחירת פיצולים אופטימליים**: עוזר לבחור פיצולים שמפרידים את הקטגוריות בצורה טובה
2. **שיפור הדיוק**: מוביל לפיצולים שמשפרים את יכולת החיזוי של העץ
3. **בניית עץ מאוזן**: עוזר בבניית עץ שאינו נוטה יותר מדי לכיוון קטגוריה מסוימת
4. **שליטה בגודל העץ**: ניתן להגדיר סף מינימלי לרווח (Gini Gain) כדי למנוע פיצולים מיותרים

## סיכום

Gini Impurity הוא כלי חשוב באלגוריתמים של עצי החלטה שעוזר לקבוע כיצד לפצל את הנתונים באופן אופטימלי. הוא מודד את מידת האי-טוהר של צומת ומאפשר השוואה בין פיצולים שונים כדי לבחור את הטוב ביותר.

המדד משתלב בתהליך הבנייה של עץ ההחלטה ומוביל ליצירת עץ שמפריד את הקטגוריות ביעילות ומשפר את הדיוק של המודל. ככל שערך ה-Gini Impurity קטן יותר, כך הצומת טהור יותר וההבדלה בין הקטגוריות טובה יותר.