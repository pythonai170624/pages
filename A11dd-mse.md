# מה זה Mean Squared Error (MSE) בעצי החלטה?

כשמשתמשים ב-**CART** לבעיות **רגרסיה** (כלומר חיזוי ערך מספרי ולא סיווג), צריך **מדד טוהר** שמתאים לנתונים רציפים.  
במקום **Gini Impurity** (שמתאים לקטגוריות), משתמשים ב-**Mean Squared Error (MSE)**.

---

## איך זה עובד?

### MSE מחשב:
\[
MSE = \frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y})^2
\]

- \( y_i \) = הערך האמיתי של כל דוגמה.
- \( \hat{y} \) = הערך הממוצע בקבוצה (התחזית).
- \( n \) = מספר הדוגמאות בקבוצה.

**מטרה:** לבחור את הפיצול ש*מפחית* הכי הרבה את ה-MSE.

---

## דוגמה פשוטה:

נניח יש לנו נתוני מכירות (באלפים):

| גיל | מכירות |
|-----|--------|
| 25  | 50     |
| 30  | 60     |
| 35  | 65     |
| 40  | 80     |

### 1. מחשבים את ה-MSE לפני פיצול:
- הממוצע של כל המכירות:  
\[
\hat{y} = \frac{50 + 60 + 65 + 80}{4} = 63.75
\]
- מחשבים את ה-MSE:

\[
MSE = \frac{1}{4} \left( (50-63.75)^2 + (60-63.75)^2 + (65-63.75)^2 + (80-63.75)^2 \right) \\
= \frac{1}{4} (189.06 + 14.06 + 1.56 + 264.06) \\
= \frac{1}{4} \cdot 468.75 = 117.19
\]

---

### 2. בודקים פיצול (למשל גיל < 32):

#### קבוצה 1 (גיל < 32):
- מכירות: 50, 60
- ממוצע:  
\[
\hat{y}_1 = \frac{50 + 60}{2} = 55
\]
- MSE:
\[
MSE_1 = \frac{1}{2} \left( (50-55)^2 + (60-55)^2 \right) = 25
\]

#### קבוצה 2 (גיל >= 32):
- מכירות: 65, 80
- ממוצע:
\[
\hat{y}_2 = \frac{65 + 80}{2} = 72.5
\]
- MSE:
\[
MSE_2 = \frac{1}{2} \left( (65-72.5)^2 + (80-72.5)^2 \right) = 56.25
\]

---

### 3. מחשבים את ה-MSE הכולל אחרי הפיצול:

\[
MSE_{after} = \frac{2}{4} \cdot MSE_1 + \frac{2}{4} \cdot MSE_2 \\
= 0.5 \cdot 25 + 0.5 \cdot 56.25 = 40.625
\]

---

### 4. בודקים את השיפור:

\[
\Delta MSE = MSE_{before} - MSE_{after} \\
= 117.19 - 40.625 = 76.56
\]

- **המסקנה:** הפיצול הזה מוריד את ה-MSE בצורה משמעותית → כדאי לבחור בו!

---

## סיכום :

- ב-**CART**:
  - **Classification** → משתמשים ב-**Gini Impurity**.
  - **Regression** → משתמשים ב-**MSE** כדי לבחור את הפיצול הכי טוב.
- **מטרה:** לבחור את הפיצול שמפחית הכי הרבה את ה-MSE → עוזר לנבא ערכים מספריים בצורה מדויקת יותר.

