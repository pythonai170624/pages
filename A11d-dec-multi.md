# חישוב Gini Impurity עבור בעיות עם מספר קלאסים

## הנוסחה למספר קלאסים

כאשר עובדים עם יותר משני קלאסים (מספר קטגוריות), הנוסחה של Gini Impurity מתרחבת באופן טבעי ל:

$$G(Q) = 1 - \sum_{i=1}^{k} p_i^2$$

כאשר:
- **Q** הוא הצומת שאנו בוחנים
- **k** הוא מספר הקלאסים
- **$p_i$** הוא ההסתברות (או החלק היחסי) של קלאס i בצומת Q

## דוגמה עם 3 קלאסים

נניח שיש לנו מערכת נתונים עם 30 דגימות:
- 15 דגימות מקלאס A (כחול)
- 10 דגימות מקלאס B (אדום)
- 5 דגימות מקלאס C (ירוק)

נחשב את Gini Impurity של הצומת:

$$p_A = \frac{15}{30} = 0.5$$
$$p_B = \frac{10}{30} = 0.33$$
$$p_C = \frac{5}{30} = 0.17$$

$$G(Q) = 1 - [(0.5)^2 + (0.33)^2 + (0.17)^2]$$
$$G(Q) = 1 - [0.25 + 0.11 + 0.03]$$
$$G(Q) = 1 - 0.39$$
$$G(Q) = 0.61$$

שימו לב שככל שיש יותר קלאסים, הערך המקסימלי של Gini Impurity גדל. עבור k קלאסים, הערך המקסימלי יהיה $(1 - \frac{1}{k})$.

## תהליך החלטה על פיצול עם מספר קלאסים

כעת, נדגים כיצד משתמשים ב-Gini Impurity כדי להחליט על פיצול אופטימלי בבעיה עם מספר קלאסים.

נניח שיש לנו מערכת נתונים עם שני מאפיינים (X1, X2) וקטגוריית יעד (Y) עם 3 קלאסים (A, B, C):

| X1 | X2 | Y |
|----|----|----|
| 1  | 3  | A  |
| 2  | 1  | A  |
| 3  | 2  | B  |
| 4  | 1  | B  |
| 5  | 3  | C  |
| 6  | 2  | C  |
| 7  | 1  | A  |
| 8  | 3  | B  |
| 9  | 2  | C  |

### חישוב Gini Impurity של השורש

- 3 דגימות מקלאס A (p_A = 3/9 = 0.33)
- 3 דגימות מקלאס B (p_B = 3/9 = 0.33)
- 3 דגימות מקלאס C (p_C = 3/9 = 0.33)

$$G(root) = 1 - [(0.33)^2 + (0.33)^2 + (0.33)^2]$$
$$G(root) = 1 - [0.11 + 0.11 + 0.11]$$
$$G(root) = 1 - 0.33$$
$$G(root) = 0.67$$

שימו לב שזהו הערך המקסימלי של Gini Impurity עבור 3 קלאסים כאשר הם מחולקים באופן שווה.

### פיצול לפי X1 ≤ 4

נבדוק את הפיצול לפי האם X1 ≤ 4:

**צומת שמאל (X1 ≤ 4)**:
- 2 דגימות מקלאס A (p_A = 2/4 = 0.5)
- 2 דגימות מקלאס B (p_B = 2/4 = 0.5)
- 0 דגימות מקלאס C (p_C = 0/4 = 0)

$$G(left) = 1 - [(0.5)^2 + (0.5)^2 + (0)^2]$$
$$G(left) = 1 - [0.25 + 0.25 + 0]$$
$$G(left) = 1 - 0.5$$
$$G(left) = 0.5$$

**צומת ימין (X1 > 4)**:
- 1 דגימה מקלאס A (p_A = 1/5 = 0.2)
- 1 דגימה מקלאס B (p_B = 1/5 = 0.2)
- 3 דגימות מקלאס C (p_C = 3/5 = 0.6)

$$G(right) = 1 - [(0.2)^2 + (0.2)^2 + (0.6)^2]$$
$$G(right) = 1 - [0.04 + 0.04 + 0.36]$$
$$G(right) = 1 - 0.44$$
$$G(right) = 0.56$$

**הממוצע המשוקלל**:
$$G_{weighted} = \frac{4}{9} \cdot 0.5 + \frac{5}{9} \cdot 0.56 = 0.22 + 0.31 = 0.53$$

**הרווח מהפיצול**:
$$Gain = G(root) - G_{weighted} = 0.67 - 0.53 = 0.14$$

### פיצול לפי X2 ≤ 2

כעת נבדוק פיצול אחר - לפי X2 ≤ 2:

**צומת שמאל (X2 ≤ 2)**:
- 1 דגימה מקלאס A (p_A = 1/5 = 0.2)
- 1 דגימה מקלאס B (p_B = 1/5 = 0.2)
- 3 דגימות מקלאס C (p_C = 3/5 = 0.6)

$$G(left) = 1 - [(0.2)^2 + (0.2)^2 + (0.6)^2]$$
$$G(left) = 1 - [0.04 + 0.04 + 0.36]$$
$$G(left) = 1 - 0.44$$
$$G(left) = 0.56$$

**צומת ימין (X2 > 2)**:
- 2 דגימות מקלאס A (p_A = 2/4 = 0.5)
- 2 דגימות מקלאס B (p_B = 2/4 = 0.5)
- 0 דגימות מקלאס C (p_C = 0/4 = 0)

$$G(right) = 1 - [(0.5)^2 + (0.5)^2 + (0)^2]$$
$$G(right) = 1 - [0.25 + 0.25 + 0]$$
$$G(right) = 1 - 0.5$$
$$G(right) = 0.5$$

**הממוצע המשוקלל**:
$$G_{weighted} = \frac{5}{9} \cdot 0.56 + \frac{4}{9} \cdot 0.5 = 0.31 + 0.22 = 0.53$$

**הרווח מהפיצול**:
$$Gain = G(root) - G_{weighted} = 0.67 - 0.53 = 0.14$$

בדוגמה זו, שני הפיצולים נותנים את אותו הרווח (0.14). במקרה כזה, האלגוריתם יכול לבחור באחד מהם לפי קריטריונים נוספים, כמו פשטות המודל או עדיפות למאפיין מסוים.

## השפעת מספר הקלאסים על Gini Impurity

ככל שמספר הקלאסים (k) גדל, הטווח של ערכי Gini Impurity משתנה:

1. **ערך מינימלי**: תמיד 0 (כאשר כל הדגימות בצומת שייכות לאותו קלאס)
2. **ערך מקסימלי**: $(1 - \frac{1}{k})$, כאשר כל הקלאסים מיוצגים באופן שווה בצומת

לדוגמה:
- עבור 2 קלאסים: הערך המקסימלי הוא $1 - \frac{1}{2} = 0.5$
- עבור 3 קלאסים: הערך המקסימלי הוא $1 - \frac{1}{3} = 0.67$
- עבור 4 קלאסים: הערך המקסימלי הוא $1 - \frac{1}{4} = 0.75$

## שיקולים מעשיים עבור בעיות עם מספר קלאסים

1. **מורכבות חישובית**: ככל שיש יותר קלאסים, החישוב של Gini Impurity עלול להיות מעט יותר יקר חישובית, אך בדרך כלל ההבדל זניח.

2. **פיצול מאוזן**: עבור בעיות עם מספר קלאסים, Gini Impurity נוטה לבחור פיצולים שמפרידים את הקלאסים באופן הומוגני יותר.

3. **התמודדות עם אי-איזון**: אם יש קלאס אחד שהוא דומיננטי מאוד (unbalanced dataset), עדיין ניתן להשתמש ב-Gini Impurity, אך יתכן שיהיה צורך בטכניקות נוספות כמו משקולות לקלאסים או דגימה מחדש של הנתונים.

4. **גבול החלטה**: בבעיות עם מספר קלאסים, השוואה בין אנטרופיה ל-Gini Impurity עשויה להראות הבדלים גדולים יותר בגבולות ההחלטה המתקבלים.

## סיכום

הנוסחה של Gini Impurity מתרחבת באופן טבעי למקרה של מספר קלאסים, והעיקרון הבסיסי נשאר זהה - אנו מחפשים את הפיצול שממזער את הממוצע המשוקלל של Gini Impurity בצמתי הבנים. ככל שיש יותר קלאסים, הערך המקסימלי של Gini Impurity גדל, אך התהליך של בחירת הפיצול האופטימלי נשאר זהה.